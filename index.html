<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Review Monroe</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 720px; margin: 40px auto; padding: 0 16px; }
    h1 { margin-bottom: 16px; }
    form { display: grid; gap: 12px; margin-bottom: 24px; }
    input, textarea, button { padding: 10px; font-size: 16px; }
    textarea { min-height: 120px; }
    button { cursor: pointer; }
    .item { border: 1px solid #ddd; padding: 12px; border-radius: 8px; margin-bottom: 12px; }
    .meta { color: #666; font-size: 14px; }
  </style>
</head>
<body>
  <h1>Review Buku, Film, Lagu</h1>

  <!-- Form input review -->
  <form id="reviewForm">
    <input type="text" id="judul" placeholder="Judul Review" required />
    <input type="text" id="jenis" placeholder="Jenis (Buku/Film/Lagu)" required />
    <textarea id="isi" placeholder="Tulis review..." required></textarea>
    <button type="submit">Simpan</button>
  </form>

  <!-- Tempat menampilkan review -->
  <div id="reviews"></div>

  <!-- Firebase SDK v9 (modular) -->
  <script type="module">
    // Import SDK dari CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } 
      from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    // GANTI dengan konfigurasi dari Firebase Console (Project settings â†’ Web app)
    const firebaseConfig = {
      apiKey: "AIzaSyCPkMrWdypuMMQiwGU9oopFi9-cv2JRE8Q",
      authDomain: "myreview-515a2.firebaseapp.com",
      projectId: "myreview-515a2",
      storageBucket: "myreview-515a2.appspot.com",
      messagingSenderId: "420564654203",
      appId: "1:420564654203:web:ffe7fc78f3fac08971eade",
      measurementId: "G-7HNDFYX11F"
    };

    // Inisialisasi Firebase & Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Referensi koleksi "reviews"
    const reviewsCol = collection(db, "reviews");

    // Handle submit form: simpan ke Firestore
    const form = document.getElementById("reviewForm");
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const judul = document.getElementById("judul").value.trim();
      const jenis = document.getElementById("jenis").value.trim();
      const isi = document.getElementById("isi").value.trim();

      if (!judul || !jenis || !isi) return;

      await addDoc(reviewsCol, {
        judul,
        jenis,
        isi,
        waktu: serverTimestamp()
      });

      form.reset();
    });

    // Tampilkan review secara real-time
    const reviewsDiv = document.getElementById("reviews");
    const q = query(reviewsCol, orderBy("waktu", "desc"));
    onSnapshot(q, (snapshot) => {
      reviewsDiv.innerHTML = "";
      snapshot.forEach((doc) => {
        const data = doc.data();
        const waktu = data.waktu?.toDate?.() ? data.waktu.toDate().toLocaleString() : "-";
        reviewsDiv.innerHTML += `
          <div class="item">
            <h3>${data.judul} <span class="meta">(${data.jenis})</span></h3>
            <p>${data.isi}</p>
            <div class="meta">Disimpan: ${waktu}</div>
          </div>
        `;
      });
    });
  </script>
</body>
</html>
